{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/robocup3ds.json"}, "html": {"href": "#!/osrf/robocup3ds"}, "avatar": {"href": "data/bytebucket.org/ravatar/{920a9983-6b31-4842-b414-a2a01bf8a4e6}ts=c_plus_plus"}}, "type": "repository", "name": "robocup3ds", "full_name": "osrf/robocup3ds", "uuid": "{920a9983-6b31-4842-b414-a2a01bf8a4e6}"}, "links": {"attachments": {"href": "data/repositories/osrf/robocup3ds/issues/16/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/robocup3ds/issues/16.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/robocup3ds/issues/16/watch"}, "comments": {"href": "data/repositories/osrf/robocup3ds/issues/16/comments_page=1.json"}, "html": {"href": "#!/osrf/robocup3ds/issues/16/reconnect-client-after-disconnect-with"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/robocup3ds/issues/16/vote"}}, "reporter": {"display_name": "jasonzliang NA", "uuid": "{663c75f1-dde2-425c-aa25-68ad2f4eb5ec}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B663c75f1-dde2-425c-aa25-68ad2f4eb5ec%7D"}, "html": {"href": "https://bitbucket.org/%7B663c75f1-dde2-425c-aa25-68ad2f4eb5ec%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:4f6d7230-9817-448e-8b0d-98cb3dd0821c/5b9c099e-6241-49a1-ba1d-fabcca24c6c3/128"}}, "nickname": "jasonzliang", "type": "user", "account_id": "557058:4f6d7230-9817-448e-8b0d-98cb3dd0821c"}, "title": "Reconnect client after disconnect with same agent uNum and teamname causes crash", "component": null, "votes": 0, "watches": 1, "content": {"raw": "To reproduce the problem, simply take the magma-protocol-tester from issue 12   (http://chaosscripting.net/files/magma-protocol-tester.zip), then:  \r\nstart gazebo with robocup3ds plugin and run the magma-protocol-tester GUI  \r\n1. connect an agent (\"connect\" button)  \r\n2. initialize it (\"Send init\" button) (after that confirm that the agent shows up in the simulator)  \r\nhit the \"disconnect\" button  \r\n3. connect an agent again and send the exact same init message as before  \r\n\r\nThe cause of the crash is due to the removal the agent's world model object from Gazebo after the client has reconnected. The reason for this is unknown and does not seem to be caused by the robocup plugin.  \r\n\r\nThis issue only happens under very specific conditions: immediate after the server is started, you disconnect and reconnect with the exact same team name and agent uNum. If you connect an agent with different uNum or teamname in between steps 2 and 3, the problem does not occur. Afterwards, any attempt to reproduce the crash by following the steps above will not happen either. \r\n\r\nThe error message:\r\n\r\n```\r\n#!c++\r\n\r\ngzserver: /usr/include/boost/smart_ptr/shared_ptr.hpp:653: typename boost::detail::sp_member_access<T>::type boost::shared_ptr<T>::operator->() const [with T = gazebo::physics::Model; typename boost::detail::sp_member_access<T>::type = gazebo::physics::Model*]: Assertion `px != 0' failed.\r\n```\r\n\r\n", "markup": "markdown", "html": "<p>To reproduce the problem, simply take the magma-protocol-tester from issue 12   (<a href=\"http://chaosscripting.net/files/magma-protocol-tester.zip\" rel=\"nofollow\" class=\"ap-connect-link\">http://chaosscripting.net/files/magma-protocol-tester.zip</a>), then:<br />\nstart gazebo with robocup3ds plugin and run the magma-protocol-tester GUI<br />\n1. connect an agent (\"connect\" button)<br />\n2. initialize it (\"Send init\" button) (after that confirm that the agent shows up in the simulator)<br />\nhit the \"disconnect\" button<br />\n3. connect an agent again and send the exact same init message as before  </p>\n<p>The cause of the crash is due to the removal the agent's world model object from Gazebo after the client has reconnected. The reason for this is unknown and does not seem to be caused by the robocup plugin.  </p>\n<p>This issue only happens under very specific conditions: immediate after the server is started, you disconnect and reconnect with the exact same team name and agent uNum. If you connect an agent with different uNum or teamname in between steps 2 and 3, the problem does not occur. Afterwards, any attempt to reproduce the crash by following the steps above will not happen either. </p>\n<p>The error message:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"nl\">gzserver</span><span class=\"p\">:</span> <span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">boost</span><span class=\"o\">/</span><span class=\"n\">smart_ptr</span><span class=\"o\">/</span><span class=\"n\">shared_ptr</span><span class=\"p\">.</span><span class=\"nl\">hpp</span><span class=\"p\">:</span><span class=\"mi\">653</span><span class=\"o\">:</span> <span class=\"k\">typename</span> <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">detail</span><span class=\"o\">::</span><span class=\"n\">sp_member_access</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;::</span><span class=\"n\">type</span> <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;::</span><span class=\"k\">operator</span><span class=\"o\">-&gt;</span><span class=\"p\">()</span> <span class=\"k\">const</span> <span class=\"p\">[</span><span class=\"n\">with</span> <span class=\"n\">T</span> <span class=\"o\">=</span> <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">physics</span><span class=\"o\">::</span><span class=\"n\">Model</span><span class=\"p\">;</span> <span class=\"k\">typename</span> <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">detail</span><span class=\"o\">::</span><span class=\"n\">sp_member_access</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;::</span><span class=\"n\">type</span> <span class=\"o\">=</span> <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">physics</span><span class=\"o\">::</span><span class=\"n\">Model</span><span class=\"o\">*</span><span class=\"p\">]</span><span class=\"o\">:</span> <span class=\"n\">Assertion</span> <span class=\"err\">`</span><span class=\"n\">px</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"err\">&#39;</span> <span class=\"n\">failed</span><span class=\"p\">.</span>\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2016-02-22T01:45:44.081165+00:00", "milestone": null, "updated_on": "2016-03-30T19:53:11.180737+00:00", "type": "issue", "id": 16}